<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>INSPINIA | Dashboard v.2</title>

    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="/font-awesome/css/font-awesome.css" rel="stylesheet">

    <link href="css/animate.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">

</head>

<body th:with="dashboard_sel='active'">
<div id="wrapper">

    <!-- left menu -->
    <div th:replace="~{_left_menu :: left-menu}"/>

    <div id="page-wrapper" class="gray-bg">
        <!-- top header -->
        <div th:replace="~{_top_header :: top-header}"/>

        <!-- content -->
        <div class="wrapper wrapper-content">
            <div class="row">
                <div class="col-lg-4">
                    <div class="ibox ">
                        <div class="ibox-title">
                            <span class="label label-info float-right">Total</span>
                            <h5>Total User</h5>
                        </div>
                        <div class="ibox-content">
                            <h1 class="no-margins" id="total">0</h1>
                            <div id="total-increase" class="stat-percent font-bold text-navy"> <i class="fa fa-level-up"></i></div>
                            <small>Total User</small>
                            <div class="progress progress-mini">
                                <div id="total-increase-progress" style="width: 0%;" class="progress-bar"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="ibox ">
                        <div class="ibox-title">
                            <span class="label label-success float-right">Active</span>
                            <h5>Active User</h5>
                        </div>
                        <div class="ibox-content">
                            <h1 class="no-margins" id="active">0</h1>
                            <small>Active User</small>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="ibox ">
                        <div class="ibox-title">
                            <span class="label label-danger float-right">Created</span>
                            <h5>Created User</h5>
                        </div>
                        <div class="ibox-content">
                            <h1 class="no-margins" id="created">0</h1>
                            <small>Created User</small>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-lg-3">
                    <div class="ibox ">
                        <div class="ibox-title">
                            <span class="label label-info float-right">Total Kapt</span>
                            <h5>Total Kapt</h5>
                        </div>
                        <div class="ibox-content">
                            <h1 class="no-margins" id="total-kapt">0</h1>
                            <small>Total Kapt</small>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3">
                    <div class="ibox ">
                        <div class="ibox-title">
                            <span class="label label-info float-right">Daily Kapt</span>
                            <h5>Daily Kapt</h5>
                        </div>
                        <div class="ibox-content">
                            <h1 class="no-margins" id="daily-kapt">0</h1>
                            <small>Daily Kapt</small>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3">
                    <div class="ibox ">
                        <div class="ibox-title">
                            <span class="label label-info float-right">Total Klay</span>
                            <h5>Total Klay</h5>
                        </div>
                        <div class="ibox-content">
                            <h1 class="no-margins" id="total-klay">0</h1>
                            <small>Total Klay</small>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3">
                    <div class="ibox ">
                        <div class="ibox-title">
                            <span class="label label-info float-right">Daily Klay</span>
                            <h5>Daily Klay</h5>
                        </div>
                        <div class="ibox-content">
                            <h1 class="no-margins" id="daily-klay">0</h1>
                            <small>Daily Klay</small>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-lg-12">
                    <div class="ibox ">
                        <div class="ibox-title">
                            <h5>Staking</h5>
                            <div class="float-right">
                                <div class="btn-group">
                                    <button type="button" class="btn btn-xs btn-white active">Weekly</button>
                                    <!--
                                    <button type="button" class="btn btn-xs btn-white">Monthly</button>
                                    <button type="button" class="btn btn-xs btn-white">Annual</button>
                                    -->
                                </div>
                            </div>
                        </div>
                        <div class="ibox-content">
                            <div class="row">
                                <div class="col-lg-9">
                                    <div class="flot-chart">
                                        <div class="flot-chart-content" id="flot-dashboard-chart"></div>
                                    </div>
                                </div>
                                <div class="col-lg-3">
                                    <ul class="stat-list">
                                        <li>
                                            <h2 id="total-participant" class="no-margins">0</h2>
                                            <small>Total staking participants</small>
                                            <div id="total-participant-percent" class="stat-percent font-bold text-navy"><i class="fa fa-level-up text-navy"></i></div>
                                            <div class="progress progress-mini">
                                                <div id="total-participant-progress" style="width: 0%;" class="progress-bar"></div>
                                            </div>
                                        </li>
                                        <li>
                                            <h2 id="total-reward" class="no-margins">0</h2>
                                            <small>Total staking rewards</small>
                                            <div id="total-reward-percent" class="stat-percent font-bold text-navy"><i class="fa fa-level-up text-navy"></i>
                                            </div>
                                            <div class="progress progress-mini">
                                                <div id="total-reward-progress" style="width: 0%;" class="progress-bar"></div>
                                            </div>
                                        </li>
                                        <li>
                                            <h2 id="weekly-participant" class="no-margins ">0</h2>
                                            <small>Weekly staking participants</small>
                                            <div id="weekly-participant-percent" class="stat-percent font-bold text-navy"><i class="fa fa-level-up text-navy"></i></div>
                                            <div class="progress progress-mini">
                                                <div id="weekly-participant-progress" style="width: 0%;" class="progress-bar"></div>
                                            </div>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-lg-4">
                    <div class="ibox ">
                        <div class="ibox-title">
                            <h5>Messages</h5>
                            <div class="ibox-tools">
                                <a class="collapse-link">
                                    <i class="fa fa-chevron-up"></i>
                                </a>
                                <a class="close-link">
                                    <i class="fa fa-times"></i>
                                </a>
                            </div>
                        </div>
                        <div class="ibox-content">
                            <div id="report" class="feed-activity-list">

                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-lg-8">

                    <div class="row">
                        <div class="col-lg-6">
                            <div class="ibox ">
                                <div class="ibox-title">
                                    <h5>Top Follower list</h5>
                                    <div class="ibox-tools">
                                        <a class="collapse-link">
                                            <i class="fa fa-chevron-up"></i>
                                        </a>
                                        <a class="close-link">
                                            <i class="fa fa-times"></i>
                                        </a>
                                    </div>
                                </div>
                                <div class="ibox-content table-responsive">
                                    <table class="table table-hover no-margins">
                                        <thead>
                                        <tr>
                                            <th>Name</th>
                                            <th>Follower</th>
                                        </tr>
                                        </thead>
                                        <tbody id="follower">

                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="ibox ">
                                <div class="ibox-title">
                                    <h5>Top Invite User</h5>
                                    <div class="ibox-tools">
                                        <a class="collapse-link">
                                            <i class="fa fa-chevron-up"></i>
                                        </a>
                                        <a class="close-link">
                                            <i class="fa fa-times"></i>
                                        </a>
                                    </div>
                                </div>
                                <div class="ibox-content">
                                    <table class="table table-hover no-margins">
                                        <thead>
                                        <tr>
                                            <th>Name</th>
                                            <th>Invite count</th>
                                        </tr>
                                        </thead>
                                        <tbody id="inviter">

                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
<!--                    <div class="row">-->
<!--                        <div class="col-lg-12">-->
<!--                            <div class="ibox ">-->
<!--                                <div class="ibox-title">-->
<!--                                    <h5>Transactions worldwide</h5>-->
<!--                                    <div class="ibox-tools">-->
<!--                                        <a class="collapse-link">-->
<!--                                            <i class="fa fa-chevron-up"></i>-->
<!--                                        </a>-->
<!--                                        <a class="close-link">-->
<!--                                            <i class="fa fa-times"></i>-->
<!--                                        </a>-->
<!--                                    </div>-->
<!--                                </div>-->
<!--                                <div class="ibox-content">-->

<!--                                    <div class="row">-->
<!--                                        <div class="col-lg-6">-->
<!--                                            <table class="table table-hover margin bottom">-->
<!--                                                <thead>-->
<!--                                                <tr>-->
<!--                                                    <th style="width: 1%" class="text-center">No.</th>-->
<!--                                                    <th>Transaction</th>-->
<!--                                                    <th class="text-center">Date</th>-->
<!--                                                    <th class="text-center">Amount</th>-->
<!--                                                </tr>-->
<!--                                                </thead>-->
<!--                                                <tbody>-->
<!--                                                <tr>-->
<!--                                                    <td class="text-center">1</td>-->
<!--                                                    <td> Security doors-->
<!--                                                    </td>-->
<!--                                                    <td class="text-center small">16 Jun 2014</td>-->
<!--                                                    <td class="text-center"><span-->
<!--                                                            class="label label-primary">$483.00</span></td>-->

<!--                                                </tr>-->
<!--                                                <tr>-->
<!--                                                    <td class="text-center">2</td>-->
<!--                                                    <td> Wardrobes-->
<!--                                                    </td>-->
<!--                                                    <td class="text-center small">10 Jun 2014</td>-->
<!--                                                    <td class="text-center"><span-->
<!--                                                            class="label label-primary">$327.00</span></td>-->

<!--                                                </tr>-->
<!--                                                <tr>-->
<!--                                                    <td class="text-center">3</td>-->
<!--                                                    <td> Set of tools-->
<!--                                                    </td>-->
<!--                                                    <td class="text-center small">12 Jun 2014</td>-->
<!--                                                    <td class="text-center"><span-->
<!--                                                            class="label label-warning">$125.00</span></td>-->

<!--                                                </tr>-->
<!--                                                <tr>-->
<!--                                                    <td class="text-center">4</td>-->
<!--                                                    <td> Panoramic pictures</td>-->
<!--                                                    <td class="text-center small">22 Jun 2013</td>-->
<!--                                                    <td class="text-center"><span-->
<!--                                                            class="label label-primary">$344.00</span></td>-->
<!--                                                </tr>-->
<!--                                                <tr>-->
<!--                                                    <td class="text-center">5</td>-->
<!--                                                    <td>Phones</td>-->
<!--                                                    <td class="text-center small">24 Jun 2013</td>-->
<!--                                                    <td class="text-center"><span-->
<!--                                                            class="label label-primary">$235.00</span></td>-->
<!--                                                </tr>-->
<!--                                                <tr>-->
<!--                                                    <td class="text-center">6</td>-->
<!--                                                    <td>Monitors</td>-->
<!--                                                    <td class="text-center small">26 Jun 2013</td>-->
<!--                                                    <td class="text-center"><span-->
<!--                                                            class="label label-primary">$100.00</span></td>-->
<!--                                                </tr>-->
<!--                                                </tbody>-->
<!--                                            </table>-->
<!--                                        </div>-->
<!--                                        <div class="col-lg-6">-->
<!--                                            <div id="world-map" style="height: 300px;"></div>-->
<!--                                        </div>-->
<!--                                    </div>-->
<!--                                </div>-->
<!--                            </div>-->
<!--                        </div>-->
<!--                    </div>-->
                </div>

            </div>
        </div>

        <!-- footer -->
        <div class="footer">
            <div class="float-right">
                10GB of <strong>250GB</strong> Free.
            </div>
            <div>
                <strong>Copyright</strong> Gamehub Korea &copy;
            </div>
        </div>
    </div>

    <!-- right-side -->
    <div th:replace="_right_side :: right-side"/>

</div>

<template id="report-template">
    <div class="feed-element">
        <div>
            <small class="float-right text-navy">{timeAgo}m ago</small>
            <strong>{name}</strong>
            <div>{note}</div>
        </div>
    </div>
</template>

<template id="follower-template">
    <tr>
        <td>
            <small>{name}</small>
        </td>
        <td class="text-navy">{follower}&nbsp;&nbsp;<i class="fa fa-bolt"></i></td>
    </tr>
</template>

<template id="inviter-template">
    <tr>
        <td>
            <small>{name}</small>
        </td>
        <td class="text-success">{count}&nbsp;&nbsp;<i class="fa fa-heart"></i></td>
    </tr>
</template>
<!-- Mainly scripts -->
<script src="js/jquery-3.1.1.min.js"></script>
<script src="js/popper.min.js"></script>
<script src="js/bootstrap.js"></script>
<script src="js/gamehub.js"></script>
<script src="js/plugins/metisMenu/jquery.metisMenu.js"></script>
<script src="js/plugins/slimscroll/jquery.slimscroll.min.js"></script>

<!-- Flot -->
<script src="js/plugins/flot/jquery.flot.js"></script>
<script src="js/plugins/flot/jquery.flot.tooltip.min.js"></script>
<script src="js/plugins/flot/jquery.flot.spline.js"></script>
<script src="js/plugins/flot/jquery.flot.resize.js"></script>
<script src="js/plugins/flot/jquery.flot.pie.js"></script>
<script src="js/plugins/flot/jquery.flot.symbol.js"></script>
<script src="js/plugins/flot/jquery.flot.time.js"></script>

<!-- Peity -->
<script src="js/plugins/peity/jquery.peity.min.js"></script>
<script src="js/demo/peity-demo.js"></script>

<!-- Custom and plugin javascript -->
<script src="js/inspinia.js"></script>
<script src="js/plugins/pace/pace.min.js"></script>

<!-- jQuery UI -->
<script src="js/plugins/jquery-ui/jquery-ui.min.js"></script>

<!-- Jvectormap -->
<script src="js/plugins/jvectormap/jquery-jvectormap-2.0.2.min.js"></script>
<script src="js/plugins/jvectormap/jquery-jvectormap-world-mill-en.js"></script>

<!-- EayPIE -->
<script src="js/plugins/easypiechart/jquery.easypiechart.js"></script>

<!-- Sparkline -->
<script src="js/plugins/sparkline/jquery.sparkline.min.js"></script>

<!-- Sparkline demo data  -->
<script src="js/demo/sparkline-demo.js"></script>

<script>
    $(document).ready(function () {
        getWalletData()
        getPurchaseData()
        getStakingData()
        getWeeklyStaking()

        /*
        $('.chart').easyPieChart({
            barColor: '#f8ac59',
            // scaleColor: false,
            scaleLength: 5,
            lineWidth: 4,
            size: 80
        });

        $('.chart2').easyPieChart({
            barColor: '#1c84c6',
            // scaleColor: false,
            scaleLength: 5,
            lineWidth: 4,
            size: 80
        });

        var mapData = {
            "US": 298,
            "SA": 200,
            "DE": 220,
            "FR": 540,
            "CN": 120,
            "AU": 760,
            "BR": 550,
            "IN": 200,
            "GB": 120,
        };

        $('#world-map').vectorMap({
            map: 'world_mill_en',
            backgroundColor: "transparent",
            regionStyle: {
                initial: {
                    fill: '#e4e4e4',
                    "fill-opacity": 0.9,
                    stroke: 'none',
                    "stroke-width": 0,
                    "stroke-opacity": 0
                }
            },

            series: {
                regions: [{
                    values: mapData,
                    scale: ["#1ab394", "#22d6b1"],
                    normalizeFunction: 'polynomial'
                }]
            },
        });
         */
    });

    function getWalletData() {
        $.ajax({
            type: 'GET',
            url: '/dashboard/wallet',
            dataType: "json",
            success: function (data) {
                displayWallet(data)
            },
            error: function () {
                alert("데이터를 가져올 수 없습니다.")
            }
        });
    }

    function displayWallet(data) {
        let createdQty = data.createdQty
        let activeQty = data.activeQty
        let total = data.totalQty
        let increaseCount = data.lastCreatedQty
        let increasePercent = (increaseCount / total * 100).toFixed(2)

        $("#active").html(activeQty)
        $("#created").html(createdQty)
        $("#total").html(total)
        $("#total-increase").prepend(`${increasePercent}%`)
        $("#total-increase-progress").attr("style", `width:${increasePercent}%`)
    }

    function getPurchaseData() {
        $.ajax({
            type: 'GET',
            url: '/dashboard/purchase',
            dataType: "json",
            success: function (data) {
                displayPurchase(data)
            },
            error: function () {
                alert("데이터를 가져올 수 없습니다.")
            }
        });
    }

    function displayPurchase(data) {
        let totalKaptQty = data.totalKaptQty
        let totalKlayQty = data.totalKlayQty
        let dailyKaptQty = data.dailyKaptQty
        let dailyKlayQty = data.dailyKlayQty

        $("#total-kapt").html(totalKaptQty)
        $("#total-klay").html(totalKlayQty)
        $("#daily-kapt").html(dailyKaptQty)
        $("#daily-klay").html(dailyKlayQty)
    }

    function getStakingData() {
        $.ajax({
            type: 'GET',
            url: '/dashboard/staking',
            dataType: "json",
            success: function (data) {
                displayStaking(data)
            },
            error: function () {
                alert("데이터를 가져올 수 없습니다.")
            }
        });
    }

    function displayStaking(data) {
        const totalParticipantQty = data.totalParticipantQty;
        const totalLastParticipantQty = data.totalLastParticipantQty;
        const increaseParticipantPercent = ((totalParticipantQty - totalLastParticipantQty) / totalParticipantQty * 100).toFixed(2)

        const totalReward = data.totalReward;
        const totalLastReward = data.totalLastReward;
        const increaseRewardPercent = ((totalReward - totalLastReward) / totalReward * 100).toFixed(2)


        const weeklyParticipantQty = data.weeklyParticipantQty;
        const increaseWeeklyRewardPercent = (weeklyParticipantQty / totalParticipantQty * 100).toFixed(2)

        $("#total-participant").html(addCommas(totalParticipantQty))
        $("#total-participant-percent").prepend(`${increaseParticipantPercent}%`)
        $("#total-participant-progress").attr("style", `width:${increaseParticipantPercent}%`)

        $("#total-reward").html(formatCoinNum(totalReward))
        $("#total-reward-percent").prepend(`${increaseRewardPercent}%`)
        $("#total-reward-progress").attr("style", `width:${increaseRewardPercent}%`)

        $("#weekly-participant").html(formatCoinNum(weeklyParticipantQty))
        $("#weekly-participant-percent").prepend(`${increaseWeeklyRewardPercent}%`)
        $("#weekly-participant-progress").attr("style", `width:${increaseWeeklyRewardPercent}%`)
    }

    function getWeeklyStaking() {
        $.ajax({
            type: 'GET',
            url: '/dashboard/weekly-staking',
            dataType: "json",
            success: function (data) {
                displayWeeklyStakingChart(data.weeklyStakingData)
            },
            error: function () {
                alert("데이터를 가져올 수 없습니다.")
            }
        });
    }

    function displayWeeklyStakingChart(data) {
        const participantData = data.map(staking => {
            return [new Date(staking.date).getTime(), staking.participantQty]
        });
        const rewardData = data.map(staking => {
            return [new Date(staking.date).getTime(), staking.reward]
        });

        const dataset = [
            {
                label: "Number of participants",
                data: participantData,
                color: "#1ab394",
                bars: {
                    show: true,
                    align: "center",
                    barWidth: 24 * 60 * 60 * 600,
                    lineWidth: 0
                }

            },
            {
                label: "Rewards",
                data: rewardData,
                yaxis: 2,
                color: "#1C84C6",
                lines: {
                    lineWidth: 1,
                    show: true,
                    fill: true,
                    fillColor: {
                        colors: [{
                            opacity: 0.2
                        }, {
                            opacity: 0.4
                        }]
                    }
                },
                splines: {
                    show: false,
                    tension: 0.6,
                    lineWidth: 1,
                    fill: 0.1
                },
            }
        ];

        const options = {
            xaxis: {
                mode: "time",
                tickSize: [1, "day"],
                tickLength: 0,
                axisLabel: "Date",
                axisLabelUseCanvas: true,
                axisLabelFontSizePixels: 12,
                axisLabelFontFamily: 'Arial',
                axisLabelPadding: 10,
                color: "#d5d5d5"
            },
            yaxes: [
                {
                    position: "left",
                    max: 1070,
                    color: "#d5d5d5",
                    axisLabelUseCanvas: true,
                    axisLabelFontSizePixels: 12,
                    axisLabelFontFamily: 'Arial',
                    axisLabelPadding: 3
                },
                {
                    position: "right",
                    clolor: "#d5d5d5",
                    axisLabelUseCanvas: true,
                    axisLabelFontSizePixels: 12,
                    axisLabelFontFamily: ' Arial',
                    axisLabelPadding: 67
                }
            ],
            legend: {
                noColumns: 1,
                labelBoxBorderColor: "#000000",
                position: "nw"
            },
            grid: {
                hoverable: false,
                borderWidth: 0
            }
        };

        $.plot($("#flot-dashboard-chart"), dataset, options);
    }
</script>
</body>
</html>
